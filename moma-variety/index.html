<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Variety</title>

    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="tip.css">
</head>

<body>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://d3js.org/queue.v1.min.js"></script>
    <script src="https://d3js.org/topojson.v1.min.js"></script>
    <script src="https://d3js.org/d3-color.v1.min.js"></script>
    <script src="https://d3js.org/d3-interpolate.v1.min.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/d3-queue.v3.min.js"></script>
    <script src="d3-tip.js"></script>

    <h1>Hello</h1>
    <div class="container">
        
        <div id="my_dataviz"></div>
            <!-- <h3 style="text-align: center;">Bar-Chart 1</h3> -->
    </div>


<script>

    // var tip = d3.tip()
    //     .attr('class', 'd3-tip')
    //     // .offset([200, 0])
    //     .html(function (d) {
    //         return "";
    //         // "<strong>Type: </strong><span class='details'>" +
    //         //     d.properties.name + "<br></span>" +
    //         //     "<strong>Artworks from " + d.properties.name + ": </strong><span class='details'>"
    //         //     + (d.count ? format(Math.pow(10, d.count)) : "0") + "</span>";
    //         })
    // Constants
    var margin = { top: 20, right: 30, bottom: 70, left: 100 },
        width = 760 - margin.left - margin.right,
        height = 520 - margin.top - margin.bottom;

    // Chart SVGs
    var svg = d3.select("#my_dataviz")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    // Reading the data
    data = d3.json('Artworks-test-Umut-3.json').then(data => {
        data = d3.values(data)
        data.sort((a,b) => d3.ascending(a.Date, b.Date))
        const mySet1 = new Set();
        data.forEach(d => {
            mySet1.add(d.Type);
        });

    /*
Arch, Design, Ill. Book, Prod. Des., Soft., Graph. Des., Poster, Furniture -> ARch & Deisng
Print, Drawing, Work on Paper, Collage, Ephemera -> Work on Paper
Film, Video, Media, Performance, Audio -> Digital Media & Performance
Sculpture, Textile, Installation -> Installation
Photograph, Photography Res. -> Photography
    */

    var mygroups = ["Architecture & Design", "Digital Media & Performance", "Work on Paper",  "Installation",  "Photography", "Painting"]

    var mygroup = Array.from(Array(mygroups.length).keys())
    for (let value of mygroup) {
        value += 1;
    }
    
    var sumstat = d3.nest()
        .key(function(d) { return d.Date;})
        .entries(data);

    // console.log(sumstat)


 // list of group names
  var stackedData = d3.stack()
    .keys(mygroup)
    .value(function(d, key){
        if (d.values[key] != undefined){
            return d.values[key].percent
        }
        else {
            return 0
        }
    })
    (sumstat)
    
    // console.log(stackedData)

//   // Add X axis --> it is a date format
  var x = d3.scaleLinear()
    .domain(d3.extent(data, function(d) {  return d.Date; }))
    .range([ 0, width ]);

  svg.append("g")
    .attr("transform", "translate(0," + height + ")")
    .call(d3.axisBottom(x).ticks(5));

  var y = d3.scaleLinear()
    .domain([0, d3.max(data, function(d) {  return +d.percent; })])
    .range([ height, 0 ]);

  svg.append("g")
    .call(d3.axisLeft(y));

  var color = d3.scaleOrdinal()
    .domain(mygroups)
    // .range(['#377eb8','#fc8d62','#8da0cb','#e78ac3','#a6d854','#ffd92f','#66c2a5'])
    .range(d3.schemeSet3)

    svg
        .selectAll("mylayers")
        .data(stackedData)
        .enter()
        .append("path")
        .style("fill", function(d) { name = mygroups[d.key-1] ; return color(name); })
        .attr("d", d3.area()
            .x(function(d, i) { return x(d.data.key); })
            .y0(function(d) {  return y(d[0]) ; })
            .y1(function(d) {  return y(d[1]) ; })
    )
        
    })

    

</script>
</body>
</html>